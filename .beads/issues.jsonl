{"id":"webserver-15m","title":"Investigate MCP/anyio Python 3.13 compatibility crash in chatboti","description":"The chatboti FastAPI app crashes on startup with a RuntimeError from anyio/MCP:\n\nRuntimeError: Attempted to exit cancel scope in a different task than it was entered in\n\nError occurs in:\n- /home/deploy/chatboti/.venv/lib/python3.13/site-packages/mcp/client/stdio/__init__.py\n- /home/deploy/chatboti/.venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py\n\nThe error happens during MCP session initialization in chatboti/agent.py when calling await self._mcp_session.initialize().\n\nThis appears to be a Python 3.13 compatibility issue with the anyio library's cancel scope handling across tasks. The MCP stdio client is likely using anyio patterns that worked in Python 3.12 but break in 3.13 due to stricter asyncio semantics.\n\nInvestigation needed:\n1. Check anyio and MCP library versions in chatboti\n2. Review Python 3.13 changes to asyncio/cancel scopes\n3. Check if there are updated anyio/MCP versions that fix this\n4. Determine if we need to pin Python version or update dependencies\n5. Test if downgrading to Python 3.12 resolves the issue\n\nLogs show the app deploys successfully but crashes immediately on startup when trying to connect to the MCP server.","status":"open","priority":2,"issue_type":"bug","owner":"apposite@gmail.com","created_at":"2026-02-12T13:15:28.795242+11:00","created_by":"Bosco Ho","updated_at":"2026-02-12T13:15:28.795242+11:00"}
{"id":"webserver-1zr","title":"Phase 2: Extract server.py module","description":"Extract SSH operations, file transfer, network validation, server setup, nginx/DNS config into server.py. Medium risk, widely used.","status":"closed","priority":2,"issue_type":"task","owner":"apposite@gmail.com","created_at":"2026-02-11T18:18:40.200751+11:00","created_by":"Bosco Ho","updated_at":"2026-02-11T18:26:10.957835+11:00","closed_at":"2026-02-11T18:26:10.957835+11:00","close_reason":"Extracted server.py module with SSH, rsync, nginx, DNS, validation functions. All imports working.","dependencies":[{"issue_id":"webserver-1zr","depends_on_id":"webserver-xgo","type":"blocks","created_at":"2026-02-11T18:18:51.841424+11:00","created_by":"Bosco Ho"}]}
{"id":"webserver-3le","title":"Add VM_SIZES validation and help text to providers","description":"Add VM_SIZES class constants to providers for validation and better UX.\n\nCurrently vm_size has no validation - users can pass invalid sizes.\n\nAdd:\n- AWSProvider.VM_SIZES class constant\n- DigitalOceanProvider.VM_SIZES class constant\n- Validation in validate_config()\n- Error messages showing valid sizes\n- CLI help text showing valid sizes (cyclopts)\n\nBenefits:\n- Fail fast with helpful errors\n- Better documentation in --help\n- Consistent with REGIONS validation","status":"closed","priority":2,"issue_type":"task","owner":"apposite@gmail.com","created_at":"2026-02-12T10:28:31.63296+11:00","created_by":"Bosco Ho","updated_at":"2026-02-12T10:30:31.247793+11:00","closed_at":"2026-02-12T10:30:31.247793+11:00","close_reason":"Added VM_SIZES validation and help text.\n\nChanges:\n- Added AWSProvider.VM_SIZES class constant (17 instance types)\n- Added DigitalOceanProvider.VM_SIZES class constant (7 sizes)\n- Updated validate_config() for both providers to validate vm_size\n- Added vm_size parameter documentation in CLI help text\n- Error messages now show all valid sizes\n\nTesting:\n- Invalid AWS size: Shows valid AWS types\n- Invalid DO size: Shows valid DO sizes\n- Help text shows examples for both providers\n\nResult: Better UX with early validation and helpful errors"}
{"id":"webserver-4jo","title":"Audit provider options usage and remove unused data","description":"Audit PROVIDER_OPTIONS to determine which fields are actually used.\n\nCurrent PROVIDER_OPTIONS contains:\n- regions (list of valid regions)\n- vm_sizes (list of valid VM sizes)  \n- os_images (list of valid OS images)\n\nInvestigation:\n- Search for all uses of PROVIDER_OPTIONS in codebase\n- Check if validation is actually performed\n- Determine if data is used or just informational\n- Remove unused fields entirely\n\nThis should be done BEFORE inlining to avoid moving unnecessary code.","notes":"Audit complete. Findings:\n\nPROVIDER_OPTIONS usage:\n- Only AWS regions are actually validated (line 489)\n- DigitalOcean regions: NOT validated\n- vm_sizes (both providers): NOT used anywhere\n- os_images (both providers): NOT used anywhere\n\nPROVIDER_OPTIONS is:\n- Exported in __init__.py but never imported by external code\n- Only used internally in _validate_and_normalize_region() for AWS\n\nRecommendation:\n1. Remove vm_sizes and os_images entirely (unused)\n2. Keep AWS regions for validation\n3. Remove DigitalOcean regions (not validated, not used)\n4. Inline AWS regions as AWSProvider.REGIONS class constant\n5. Remove PROVIDER_OPTIONS dict entirely\n6. Remove from __init__.py exports","status":"closed","priority":2,"issue_type":"task","owner":"apposite@gmail.com","created_at":"2026-02-12T10:22:23.372691+11:00","created_by":"Bosco Ho","updated_at":"2026-02-12T10:25:57.006844+11:00","closed_at":"2026-02-12T10:25:57.006844+11:00","close_reason":"Removed unused PROVIDER_OPTIONS data and inlined AWS regions.\n\n- Removed vm_sizes and os_images (unused for both providers)\n- Removed DigitalOcean regions (not validated, not used)\n- Inlined AWS regions as AWSProvider.REGIONS class constant\n- Removed PROVIDER_OPTIONS dict entirely  \n- Removed from __init__.py exports\n\nResult: -48 lines, cleaner code, better encapsulation"}
{"id":"webserver-5eu","title":"Remove obvious comments/docstrings and rewrite remaining in Sphinx format","status":"closed","priority":2,"issue_type":"task","owner":"apposite@gmail.com","created_at":"2026-02-11T17:39:09.260911+11:00","created_by":"Bosco Ho","updated_at":"2026-02-11T18:00:02.161966+11:00","closed_at":"2026-02-11T18:00:02.161966+11:00","close_reason":"Removed obvious comments/docstrings, rewrote remaining docstrings in concise Sphinx format. Reduced file from 2614 to 2332 lines (282 lines removed)."}
{"id":"webserver-5hm","title":"Wrap complex strings with quotes in log messages","description":"Improve log readability by consistently wrapping complex strings with single quotes.\n\nCurrent inconsistency:\n  [INFO] Creating instance chatboti on aws...\n  [INFO] Using AMI: ami-0abc123\n  [ERROR] No Route53 hosted zone found for example.com\n\nProposed consistency:\n  [INFO] Creating instance 'chatboti' on 'aws'...\n  [INFO] Using AMI: 'ami-0abc123'\n  [ERROR] No Route53 hosted zone found for 'example.com'\n\nStrings to quote:\n- Instance names\n- Domain names\n- File paths\n- AMI IDs\n- Security group names\n- IAM role names\n- VM sizes\n- Region names\n- Provider names\n- IP addresses\n- SSH key names\n\nBenefits:\n- Clearer distinction between log text and values\n- Easier to parse logs programmatically\n- More professional appearance\n- Helps identify empty/whitespace values\n\nScope:\n- Review all log(), warn(), error() calls in:\n  - deploy_vm/cli.py\n  - deploy_vm/providers.py\n  - deploy_vm/server.py\n  - deploy_vm/utils.py\n- Apply consistent quoting pattern\n- Consider f-string pattern: log(f\"Creating instance '{name}' on '{provider}'...\")\n\nExample patterns:\n  log(f\"Creating instance '{name}'...\")\n  error(f\"Invalid region: '{region}'\")\n  warn(f\"File not found: '{path}'\")\n\nNotes:\n- Don't quote simple words (on, in, with, etc.)\n- Always quote user-provided values\n- Always quote identifiers (names, IDs, paths)","status":"closed","priority":3,"issue_type":"task","owner":"apposite@gmail.com","created_at":"2026-02-12T11:45:23.508088+11:00","created_by":"Bosco Ho","updated_at":"2026-02-12T13:01:41.293605+11:00","closed_at":"2026-02-12T13:01:41.293605+11:00","close_reason":"Added quotes to all complex strings in logs"}
{"id":"webserver-5qj","title":"Strip AWS_PROFILE from .env before uploading to AWS instances","description":"When deploying FastAPI apps to AWS EC2, automatically remove AWS_PROFILE from .env files before uploading.\n\nProblem:\n- Local development uses AWS_PROFILE in .env for AWS credentials\n- EC2 instances use IAM instance profiles (no AWS_PROFILE needed)\n- If AWS_PROFILE is uploaded, it can interfere with IAM role credentials\n- App on EC2 might try to use non-existent profile instead of IAM role\n\nExample scenario:\nLocal .env:\n  AWS_PROFILE=myprofile\n  AWS_REGION=us-east-1\n  OTHER_VAR=value\n\nShould become on EC2 instance:\n  AWS_REGION=us-east-1\n  OTHER_VAR=value\n\nSolution approach:\n1. When uploading .env in deploy_fastapi() or deploy_nuxt()\n2. Detect if target is AWS provider\n3. Read .env file\n4. Filter out AWS_PROFILE line\n5. Upload filtered version\n\nImplementation location:\n- deploy_vm/server.py: deploy_fastapi() function\n- Look for where .env is uploaded\n- Add filtering step before upload\n\nCode pattern:\n  if provider == 'aws' and env_file.exists():\n      # Read .env\n      lines = env_file.read_text().splitlines()\n      # Filter out AWS_PROFILE\n      filtered = [l for l in lines if not l.startswith('AWS_PROFILE=')]\n      # Upload filtered version\n      ...\n\nAlternative considerations:\n- Also filter AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY?\n- Add warning when filtering occurs?\n- Log what was filtered?\n- Consider whitelist approach instead?\n\nRelated:\n- This complements the IAM role setup we already do\n- Ensures app uses IAM role credentials correctly\n- Prevents credential conflicts\n\nPriority: P2 (can cause auth issues in production)","status":"closed","priority":2,"issue_type":"task","owner":"apposite@gmail.com","created_at":"2026-02-12T11:59:59.80564+11:00","created_by":"Bosco Ho","updated_at":"2026-02-12T12:46:43.443908+11:00","closed_at":"2026-02-12T12:46:43.443908+11:00","close_reason":"Implemented AWS credential filtering from .env files"}
{"id":"webserver-8f1","title":"Rename --provider-name to --provider in CLI","description":"Rename the --provider-name flag to just --provider for brevity across all CLI commands.\n\nCurrent usage (verbose):\n  deploy-vm instance create my-server --provider-name aws\n  deploy-vm dns nameservers example.com --provider-name aws\n  deploy-vm nginx ssl my-server example.com user@example.com --provider-name aws\n\nProposed usage (concise):\n  deploy-vm instance create my-server --provider aws\n  deploy-vm dns nameservers example.com --provider aws\n  deploy-vm nginx ssl my-server example.com user@example.com --provider aws\n\nChanges needed:\n1. Update cli.py - rename all 'provider_name' parameters to 'provider'\n2. Update function signatures (get_provider, create_instance, etc.)\n3. Update docstrings and help text\n4. Update README.md examples\n5. Update DOMAIN_SETUP.md examples\n6. Keep backward compatibility or document breaking change\n\nFiles to modify:\n- deploy_vm/cli.py (all commands with provider_name parameter)\n- deploy_vm/providers.py (get_provider function signature)\n- README.md (all example commands)\n- DOMAIN_SETUP.md (all example commands)\n\nConsiderations:\n- Breaking change - existing scripts using --provider-name will break\n- Could support both flags temporarily with deprecation warning\n- Or just update and document as breaking change in changelog\n\nType: Refactoring for better UX","status":"closed","priority":2,"issue_type":"task","owner":"apposite@gmail.com","created_at":"2026-02-12T11:20:13.20746+11:00","created_by":"Bosco Ho","updated_at":"2026-02-12T12:59:23.250998+11:00","closed_at":"2026-02-12T12:59:23.250998+11:00","close_reason":"Renamed --provider-name to --provider for better UX"}
{"id":"webserver-8xt","title":"Auto-create Route53 hosted zone in dns nameservers command","description":"Update dns nameservers command to automatically create Route53 hosted zone if it doesn't exist, removing manual step for users","status":"closed","priority":2,"issue_type":"feature","owner":"apposite@gmail.com","created_at":"2026-02-11T20:45:03.783158+11:00","created_by":"Bosco Ho","updated_at":"2026-02-11T20:47:20.962402+11:00","closed_at":"2026-02-11T20:47:20.962402+11:00","close_reason":"Enhanced dns nameservers to cache results in JSON file"}
{"id":"webserver-9nu","title":"Add os_image field to instance.json for AWS provider","description":"Support specifying os_image in instance.json configuration for AWS deployments","status":"closed","priority":2,"issue_type":"task","owner":"apposite@gmail.com","created_at":"2026-02-11T19:47:40.203776+11:00","created_by":"Bosco Ho","updated_at":"2026-02-12T10:36:38.849896+11:00","closed_at":"2026-02-12T10:36:38.849896+11:00","close_reason":"Implemented: AWS now saves resolved AMI ID to instance.json"}
{"id":"webserver-ac3","title":"Add dns nameservers command","description":"Add command to display Route53 or DigitalOcean nameservers for a domain with setup instructions","status":"closed","priority":2,"issue_type":"feature","owner":"apposite@gmail.com","created_at":"2026-02-11T20:37:30.625705+11:00","created_by":"Bosco Ho","updated_at":"2026-02-11T20:37:37.833003+11:00","closed_at":"2026-02-11T20:37:37.833003+11:00","close_reason":"Implemented dns nameservers command for AWS Route53 and DigitalOcean"}
{"id":"webserver-ayw","title":"Review certbot renewal strategy","description":"Review and document how certbot renewals work in deploy-vm.\n\nCurrent state:\n- certbot installs cron job automatically for renewals\n- Certificates renew every 90 days\n- No manual intervention needed (theoretically)\n\nQuestions to investigate:\n1. Does certbot cron job work correctly on Ubuntu instances?\n2. Should we add a manual 'deploy-vm ssl renew' command for troubleshooting?\n3. Should we add monitoring/alerts for certificate expiration?\n4. Should we document renewal process in DOMAIN_SETUP.md?\n5. What happens if renewal fails? (email notifications?)\n\nTasks:\n- Test certbot auto-renewal on a running instance\n- Document renewal process in DOMAIN_SETUP.md\n- Consider adding manual renewal command\n- Consider adding expiry check to 'instance verify'\n\nReferences:\n- certbot auto-renewal: https://certbot.eff.org/docs/using.html#automated-renewals\n- Current implementation: setup_nginx_ssl() in server.py\n- Future enhancement mentioned in DOMAIN_SETUP.md line ~425","status":"open","priority":3,"issue_type":"task","owner":"apposite@gmail.com","created_at":"2026-02-12T11:19:26.656804+11:00","created_by":"Bosco Ho","updated_at":"2026-02-12T11:19:26.656804+11:00"}
{"id":"webserver-bl6","title":"Add docstrings to DigitalOceanProvider methods","description":"Add Sphinx-style docstrings to DigitalOceanProvider methods: validate_auth, instance_exists, create_instance, delete_instance, list_instances, dns_create_a_record, dns_delete_a_record. Focus on lines 60-250 in providers.py.","status":"closed","priority":3,"issue_type":"task","owner":"apposite@gmail.com","created_at":"2026-02-12T11:03:57.887773+11:00","created_by":"Bosco Ho","updated_at":"2026-02-12T11:05:35.205856+11:00","closed_at":"2026-02-12T11:05:35.205856+11:00","close_reason":"Added Sphinx docstrings to all existing DigitalOceanProvider methods (validate_auth, instance_exists, create_instance, delete_instance, list_instances). Note: dns_create_a_record and dns_delete_a_record methods don't exist in the codebase."}
{"id":"webserver-eub","title":"Add docstrings to AWSProvider helper methods","description":"Add Sphinx-style docstrings to AWSProvider private helper methods: _validate_vpc, _get_my_ip, _ensure_iam_role_and_profile, _ensure_ssh_key, _ensure_security_group. Focus on lines 500-700 in providers.py.","status":"closed","priority":3,"issue_type":"task","owner":"apposite@gmail.com","created_at":"2026-02-12T11:03:59.55398+11:00","created_by":"Bosco Ho","updated_at":"2026-02-12T11:05:34.078308+11:00","closed_at":"2026-02-12T11:05:34.078308+11:00","close_reason":"Added Sphinx docstrings to all AWSProvider helper methods"}
{"id":"webserver-fn0","title":"Create domain setup specification document","description":"Document how domain/DNS integration works for AWS and DigitalOcean providers, including setup, troubleshooting, and usage patterns","status":"closed","priority":2,"issue_type":"task","owner":"apposite@gmail.com","created_at":"2026-02-11T20:36:23.509121+11:00","created_by":"Bosco Ho","updated_at":"2026-02-11T20:36:30.298585+11:00","closed_at":"2026-02-11T20:36:30.298585+11:00","close_reason":"Created comprehensive DOMAIN_SETUP.md specification document"}
{"id":"webserver-kic","title":"Inline PROVIDER_OPTIONS into individual Provider classes","description":"Move PROVIDER_OPTIONS dictionary data into class-level constants.\n\nCurrently PROVIDER_OPTIONS is a global dict. Should be inlined as:\n- AWSProvider.REGIONS\n- AWSProvider.VM_SIZES  \n- AWSProvider.OS_IMAGES\n- DigitalOceanProvider.REGIONS\n- DigitalOceanProvider.VM_SIZES\n- DigitalOceanProvider.OS_IMAGES\n\nBenefits: Better encapsulation, clearer ownership, eliminates global state\n\nFiles: deploy_vm/providers.py","status":"closed","priority":2,"issue_type":"task","owner":"apposite@gmail.com","created_at":"2026-02-12T10:22:30.316601+11:00","created_by":"Bosco Ho","updated_at":"2026-02-12T10:38:11.549399+11:00","closed_at":"2026-02-12T10:38:11.549399+11:00","close_reason":"Completed: All useful PROVIDER_OPTIONS data now inlined as class constants","dependencies":[{"issue_id":"webserver-kic","depends_on_id":"webserver-4jo","type":"blocks","created_at":"2026-02-12T10:22:34.913802+11:00","created_by":"Bosco Ho"}]}
{"id":"webserver-mg0","title":"Extract _ensure_security_group from create_instance","description":"Extract security group handling logic (lines 742-842) into _ensure_security_group() helper method.\n\nTakes: ec2 client\nReturns: sg_id\nLogic: Find existing security group, or create new one with:\n- VPC validation and selection\n- Security group creation with tags\n- Firewall rules (SSH, HTTP, HTTPS)\n- IP restriction for SSH\n\nResult: ~100 lines extracted from create_instance","status":"closed","priority":2,"issue_type":"task","owner":"apposite@gmail.com","created_at":"2026-02-12T10:44:48.360271+11:00","created_by":"Bosco Ho","updated_at":"2026-02-12T10:46:47.064834+11:00","closed_at":"2026-02-12T10:46:47.064834+11:00","close_reason":"Extracted _ensure_security_group helper method"}
{"id":"webserver-mm8","title":"Extract _ensure_ssh_key from create_instance","description":"Extract SSH key handling logic (lines 728-740) into _ensure_ssh_key() helper method.\n\nTakes: ec2 client, key_content, fingerprint\nReturns: key_name\nLogic: Check if key exists, upload if not\n\nResult: ~13 lines extracted from create_instance","status":"closed","priority":2,"issue_type":"task","owner":"apposite@gmail.com","created_at":"2026-02-12T10:44:46.023266+11:00","created_by":"Bosco Ho","updated_at":"2026-02-12T10:45:47.035529+11:00","closed_at":"2026-02-12T10:45:47.035529+11:00","close_reason":"Extracted _ensure_ssh_key helper method"}
{"id":"webserver-qaz","title":"Fix undefined provider variable and add SSH user helper","status":"closed","priority":1,"issue_type":"bug","owner":"apposite@gmail.com","created_at":"2026-02-11T18:15:27.566225+11:00","created_by":"Bosco Ho","updated_at":"2026-02-11T18:17:32.220706+11:00","closed_at":"2026-02-11T18:17:32.220706+11:00","close_reason":"Added get_ssh_user() helper and fixed 4 undefined provider bugs"}
{"id":"webserver-vzw","title":"Add docstrings to server.py utility functions","description":"Add Sphinx-style docstrings to functions in server.py: setup_firewall, setup_swap, create_user, load_instance, save_instance, add_app_to_instance.","status":"closed","priority":3,"issue_type":"task","owner":"apposite@gmail.com","created_at":"2026-02-12T11:04:01.57288+11:00","created_by":"Bosco Ho","updated_at":"2026-02-12T11:06:02.465276+11:00","closed_at":"2026-02-12T11:06:02.465276+11:00","close_reason":"Added Sphinx docstrings to all server.py utility functions"}
{"id":"webserver-x2i","title":"Add IAM role support for AWS EC2 instances","description":"Enable AWS Bedrock and other AWS service access from EC2 by adding IAM role/instance profile support. Changes needed: (1) Add iam_role parameter to CLI, (2) Implement IAM role creation/lookup in AWS provider, (3) Attach instance profile during ec2.run_instances, (4) Update docs","status":"closed","priority":2,"issue_type":"feature","owner":"apposite@gmail.com","created_at":"2026-02-12T07:33:46.335768+11:00","created_by":"Bosco Ho","updated_at":"2026-02-12T07:37:39.60058+11:00","closed_at":"2026-02-12T07:37:39.60058+11:00","close_reason":"Implemented IAM role support for AWS EC2 instances. Added --iam-role flag, automatic role/profile creation, Bedrock access, and documentation."}
{"id":"webserver-x68","title":"Phase 3: Extract apps.py and refactor CLI","description":"Create BaseApp, NuxtApp, FastAPIApp classes. Update cli.py with imports. Create package structure. Medium-high risk.","status":"closed","priority":2,"issue_type":"task","owner":"apposite@gmail.com","created_at":"2026-02-11T18:18:41.73517+11:00","created_by":"Bosco Ho","updated_at":"2026-02-11T18:30:18.893756+11:00","closed_at":"2026-02-11T18:30:18.893756+11:00","close_reason":"Extracted apps.py with BaseApp, NuxtApp, FastAPIApp. Refactored deploy_vm.py to cli.py.","dependencies":[{"issue_id":"webserver-x68","depends_on_id":"webserver-xgo","type":"blocks","created_at":"2026-02-11T18:18:52.347716+11:00","created_by":"Bosco Ho"},{"issue_id":"webserver-x68","depends_on_id":"webserver-1zr","type":"blocks","created_at":"2026-02-11T18:18:52.489956+11:00","created_by":"Bosco Ho"}]}
{"id":"webserver-xgo","title":"Phase 1: Extract providers.py module","description":"Extract Provider Protocol, cloud provider classes, and factory function into separate providers.py module. Low risk, isolated code.","status":"closed","priority":2,"issue_type":"task","owner":"apposite@gmail.com","created_at":"2026-02-11T18:18:38.890087+11:00","created_by":"Bosco Ho","updated_at":"2026-02-11T18:22:08.577926+11:00","closed_at":"2026-02-11T18:22:08.577926+11:00","close_reason":"Extracted providers module with Protocol, DigitalOcean, and AWS classes. Imports working."}
